================================================================================
POLYGEIST INTEGRATION - END-TO-END TESTING COMMANDS
================================================================================

IMPORTANT: You need to build Polygeist first!
--------------------------------------------------------------------------------
If you haven't built Polygeist yet, run this first:

    ./setup_polygeist.sh          # Build Polygeist (15-45 mins, one time)
    source ./polygeist_env.sh     # Load Polygeist into PATH

See SETUP_POLYGEIST.md for details.

RECOMMENDED: Start here for complete testing
--------------------------------------------------------------------------------
./test_polygeist_e2e.sh

This comprehensive test will:
  ✓ Check all prerequisites (clang, mlir-opt, mlir-translate, cgeist)
  ✓ Build MLIR obfuscation library
  ✓ Test standalone MLIR passes (symbol-obfuscate, string-encrypt, scf-obfuscate)
  ✓ Test traditional pipeline (C -> LLVM -> MLIR)
  ✓ Test Polygeist pipeline (C -> func/scf/memref -> MLIR)
  ✓ Verify obfuscation (symbols hidden, strings encrypted)
  ✓ Execute binaries and verify correctness

Expected time: 30-60 seconds
Expected result: All tests pass with green checkmarks


ALTERNATIVE TEST OPTIONS
--------------------------------------------------------------------------------

Option 1: Polygeist-focused test
    cd mlir-obs
    ./test-polygeist-integration.sh

    Tests:
      - Library loading
      - Traditional and Polygeist pipelines
      - Dual-dialect support
      - Example files (if available)

Option 2: Full system integration (Python CLI + MLIR)
    ./test_mlir_integration.sh

    Tests:
      - Python CLI integration
      - String encryption via CLI
      - Symbol obfuscation via CLI
      - Combined obfuscation
      - Binary analysis

Option 3: Quick MLIR pass test
    cd mlir-obs
    ./test.sh

    Tests:
      - Basic pass functionality only
      - Fastest test (5-10 seconds)


MANUAL TESTING - STEP BY STEP
--------------------------------------------------------------------------------

Step 1: Build MLIR library
    cd mlir-obs
    ./build.sh
    cd ..

Step 2: Create test file
    cat > test.c << 'EOF'
    int add(int a, int b) { return a + b; }
    int main() { return add(2, 3); }
    EOF

Step 3: Run Polygeist pipeline
    ./mlir-obs/polygeist-pipeline.sh test.c output_binary

Step 4: Test execution
    ./output_binary
    echo $?  # Should print: 5

Step 5: Verify obfuscation
    nm output_binary | grep "add"  # Should NOT find it
    nm output_binary | grep "f_"   # Should find obfuscated symbols


WHAT GETS TESTED
--------------------------------------------------------------------------------

Traditional Pipeline (LLVM dialect):
    C -> LLVM IR -> MLIR (LLVM) -> Obfuscate -> Binary

    Tests:
      [✓] C to LLVM IR compilation
      [✓] LLVM IR to MLIR import
      [✓] Symbol obfuscation (LLVM::LLVMFuncOp)
      [✓] Binary generation
      [✓] Execution correctness

Polygeist Pipeline (High-level dialects):
    C -> Polygeist MLIR -> Obfuscate -> Lower -> Binary

    Tests:
      [✓] C to Polygeist MLIR (func, scf, memref, affine)
      [✓] Symbol obfuscation (func::FuncOp)
      [✓] SCF control-flow obfuscation
      [✓] String encryption
      [✓] Lowering to LLVM dialect
      [✓] Binary generation
      [✓] Execution correctness

Verification:
      [✓] Secret strings hidden from `strings` command
      [✓] Function symbols obfuscated
      [✓] Binary size analysis
      [✓] Exit code correctness


EXPECTED OUTPUT
--------------------------------------------------------------------------------

Success looks like:

    ╔════════════════════════════════════════════════════════════╗
    ║  ✅ ALL TESTS PASSED!                                     ║
    ╚════════════════════════════════════════════════════════════╝

    ✓ Polygeist integration is fully functional!

    What's working:
      ✓ C -> Polygeist MLIR (func, scf, memref, affine)
      ✓ Symbol obfuscation on high-level dialects
      ✓ SCF control-flow obfuscation
      ✓ String encryption
      ✓ Lowering to LLVM dialect
      ✓ Binary generation and execution

Sample test results:
    ✅ PASS: C to Polygeist MLIR generation
    ✅ PASS: func dialect present
    ✅ PASS: SCF/Affine dialect present
    ✅ PASS: Symbol obfuscation (func dialect)
    ✅ PASS: Symbols obfuscated (func dialect)
    ✅ PASS: String encryption
    ✅ PASS: Binary execution (Polygeist) - exit code 42
    ✅ PASS: Secret strings hidden
    ✅ PASS: Function symbols obfuscated


IF TESTS FAIL
--------------------------------------------------------------------------------

Check prerequisites:
    which cgeist        # Should show path to Polygeist
    which mlir-opt      # Should show path to MLIR tools
    which clang         # Should show path to compiler

Check build:
    cd mlir-obs
    ./build.sh
    find build -name "*MLIRObfuscation.*"

View logs:
    cat /tmp/mlir_build.log

If Polygeist not installed:
    Some tests will be skipped (this is OK for testing LLVM dialect only)
    To install Polygeist:
        git clone --recursive https://github.com/llvm/Polygeist
        cd Polygeist && mkdir build && cd build
        cmake -G Ninja .. -DMLIR_DIR=/path/to/llvm/lib/cmake/mlir
        ninja
        export PATH=$PWD/bin:$PATH


QUICK REFERENCE
--------------------------------------------------------------------------------

Test                            | Command                              | Time
--------------------------------|--------------------------------------|--------
Complete E2E                    | ./test_polygeist_e2e.sh             | 30-60s
Polygeist only                  | mlir-obs/test-polygeist-integration | 15-30s
Full system                     | ./test_mlir_integration.sh          | 45-90s
Quick pass test                 | mlir-obs/test.sh                    | 5-10s
Manual pipeline                 | mlir-obs/polygeist-pipeline.sh ...  | varies


DOCUMENTATION
--------------------------------------------------------------------------------

Detailed guides:
    - QUICK_TEST.md     : Quick start and common commands
    - TESTING_GUIDE.md  : Comprehensive testing guide
    - TEST_COMMANDS.txt : This file
    - README.md         : Project overview

Pipeline scripts:
    - mlir-obs/polygeist-pipeline.sh          : Full Polygeist pipeline
    - mlir-obs/test-polygeist-integration.sh  : Integration tests
    - test_polygeist_e2e.sh                   : Complete E2E tests


NEXT STEPS AFTER TESTING
--------------------------------------------------------------------------------

Once tests pass:

1. Test with real code:
    ./mlir-obs/polygeist-pipeline.sh your_app.c obfuscated_output

2. Integrate with build system:
    Add to Makefile/CMakeLists.txt

3. Deploy to production:
    Use the pipeline script in your CI/CD

4. Monitor performance:
    Compare baseline vs obfuscated execution times


CONTACT & SUPPORT
--------------------------------------------------------------------------------

For issues:
    1. Check logs in /tmp/
    2. Review TESTING_GUIDE.md
    3. Verify LLVM/MLIR version compatibility
    4. Test each pass individually

Expected versions:
    - LLVM/MLIR: 19+
    - Polygeist: Compatible with LLVM 19+
    - Clang: 19+

================================================================================
